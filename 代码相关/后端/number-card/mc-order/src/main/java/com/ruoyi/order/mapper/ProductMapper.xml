<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.order.mapper.ProductMapper">

    <select id="selectAdminAgentProduct" resultType="com.ruoyi.common.order.bo.AgentProductBO">
        SELECT
            p.product_id as productId,
            p.product_code as productCode,
            p.product_name as productName,
            p.operator_type as operatorType,
            p.product_type as productType,
            p.product_template_json as productTemplateJson,
            p.upstream_api_code as upstreamApiCode,
            p.upstream_api_name as upstreamApiName,
            p.upstream_product_code as upstreamProductCode,
            p.upstream_product_name as upstreamProductName,
            p.product_status as productStatus,
            p.product_commission as productCommission,
            p.product_commission as distributionProductCommission,
            0 as revenueProductCommission,
            p.product_sort as productSort
        FROM
            t_product p
        WHERE
         p.product_code = #{productCode}
    </select>


    <select id="selectAgentProduct" resultType="com.ruoyi.common.order.bo.AgentProductBO">
        SELECT
            p.product_id AS productId,
            a.agent_product_id AS agentProductId,
            p.product_code AS productCode,
            p.product_name AS productName,
            p.operator_type AS operatorType,
            p.product_type AS productType,
            p.product_template_json AS productTemplateJson,
            p.upstream_api_code AS upstreamApiCode,
            p.upstream_api_name AS upstreamApiName,
            p.upstream_product_code AS upstreamProductCode,
            p.upstream_product_name AS upstreamProductName,
            a.agent_code AS agentCode,
            a.agent_name AS agentName,
            a.product_status AS productStatus,
            a.product_commission AS productCommission,
            a.distribution_product_commission AS distributionProductCommission,
            a.revenue_product_commission AS revenueProductCommission,
            a.product_sort AS productSort,
            c.parent_agent_list AS parentAgentList

        FROM
            t_product p
            LEFT JOIN  t_agent_product a ON p.product_code = a.parent_product_code
            LEFT JOIN t_agent_account c ON c.agent_code = a.agent_code
        WHERE
        a.agent_code = #{agentCode}
        and p.product_code = #{productCode}
        ORDER BY a.product_sort DESC
    </select>
</mapper>
