<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.console.mapper.ProductMapper">


    <select id="selectAgentProductListCount" resultType="java.lang.Integer">
        SELECT
            count(*)
        FROM
            t_product p INNER JOIN t_agent_product a ON p.product_code = a.parent_product_code
        WHERE
        a.agent_code = #{agentCode}
        <if test="operatorType != null">
            AND p.operator_type = #{operatorType}
        </if>
        <if test="productName != null and productName != ''">
            AND p.product_name like concat('%', #{productName}, '%')
        </if>
        <if test="productStatus != null">
            AND a.product_status = #{productStatus}
        </if>
        <if test="productType != null">
            AND p.product_type = #{productType}
        </if>
        ORDER BY a.product_sort,a.create_time desc
    </select>




    <select id="selectAgentProductList" resultType="com.ruoyi.common.order.vo.AgentProductVO">
        SELECT
            p.product_id as productId,
            p.product_code as productCode,
            p.product_name as productName,
            p.operator_type as operatorType,
            p.product_type as productType,
            p.product_demand as productDemand,
            p.product_master_map as productMasterMap,
            p.product_template_json as productTemplateJson,
            p.product_tyll as productTyll,
            p.product_dxll as productDxll,
            p.product_thfz as productThfz,
            p.product_yhyz as productYhyz,
            p.product_ysyz as productYsyz,
            p.product_scsm as productScsm,
            p.product_gsdq as productGsdq,
            p.product_fafs as productFafs,
            p.product_hyqx as productHyqx,
            p.product_tcjs as productTcjs,
            p.product_age_min as productAgeMin,
            p.product_age_max as productAgeMax,
            p.product_detail_map as productDetailMap,
            a.agent_product_id as agentProductId,
            a.product_status as productStatus,
            a.product_commission AS productCommission,
            a.distribution_product_commission AS distributionProductCommission,
            a.revenue_product_commission AS revenueProductCommission,
            a.product_sort as productSort,
            a.product_qrcode_map as productQrcodeMap

        FROM
            t_product p INNER JOIN t_agent_product a ON p.product_code = a.parent_product_code
        WHERE
        a.agent_code = #{agentCode}
        <if test="operatorType != null">
            AND p.operator_type = #{operatorType}
        </if>
        <if test="productName != null and productName != ''">
            AND p.product_name like concat('%', #{productName}, '%')
        </if>
        <if test="productStatus != null">
            AND a.product_status = #{productStatus}
        </if>
        <if test="productType != null">
            AND p.product_type = #{productType}
        </if>
        ORDER BY a.product_sort,a.create_time desc
        limit #{offset},#{pageSize}
    </select>
</mapper>
