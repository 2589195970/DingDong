<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.console.mapper.OrderMapper">

    <select id="selectAgentOrderAPPStatistics" resultType="com.ruoyi.common.order.vo.AgentOrderAPPStatisticsVO">
        SELECT
        SUM(CASE WHEN create_time >= unix_timestamp(current_date) * 1000 THEN 1 ELSE 0 END) AS todayOrderNumber,
        SUM(CASE WHEN create_time >= unix_timestamp(current_date - INTERVAL 1 DAY) * 1000
        AND create_time &lt;= unix_timestamp(current_date) * 1000 THEN 1 ELSE 0 END) AS yesterdayOrderNumber,
        COUNT(*) AS totalOrderNumber
        FROM
        t_order o
        WHERE
        1=1
        <if test="downstreamCode != null and downstreamCode != ''">
            AND o.downstream_code = #{downstreamCode}
        </if>
        <if test="downstreamTeam != null and downstreamTeam != ''">
            AND o.downstream_father_list like concat('%', #{downstreamTeam}, '%')
        </if>

    </select>


    <select id="selectActivateAgentOrderAPPStatistics" resultType="com.ruoyi.common.order.vo.AgentActivateOrderAPPStatisticsVO">
        SELECT
        COUNT(*) AS totalOrderNumber,
        SUM(active_time IS NOT NULL AND active_time > 0 and order_status = 4) AS activatedOrderNumber,
        SUM(order_commission_status IN (3)) AS settledOrderNumber
        FROM
        t_order o
        WHERE
        1=1
        <if test="downstreamCode != null and downstreamCode != ''">
            AND o.downstream_code = #{downstreamCode}
        </if>
        <if test="downstreamTeam != null and downstreamTeam != ''">
            AND o.downstream_father_list like concat('%', #{downstreamTeam}, '%')
        </if>

    </select>


</mapper>
